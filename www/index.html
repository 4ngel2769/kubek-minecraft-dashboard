<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Kubek - Minecraft Servers</title>

  <link rel="stylesheet" href="css/bootstrap.min.css">

  <script src="js/jquery-3.6.0.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="css/animate.min.css" />
  <script src="js/shards.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/toastify.min.css">
  <script type="text/javascript" src="js/toastify-js.js"></script>
  <script src="js/app.js"></script>
  <link rel="stylesheet" href="css/shards.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <script src="js/sweetalert2.all.min.js"></script>
  <script src="js/progressbar.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="ntc-pool"></div>
  <div class="modal fade" id="downloadFileModal" tabindex="-1" role="dialog" aria-labelledby="downloadFileModallLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="downloadFileModalLabel">Downloading file</h5>
        </div>
        <div class="modal-body">
          <center>
            <p style="color: black;" class="fdStatus"></p>
            <progress id="fdProgress" max="100" value="0"></progress>
          </center>
        </div>
      </div>
    </div>
  </div>
  <div class="loadBg" style="display: none;"><span
      class="loadText animate__animated animate__infinite animate__heartBeat">K</span></div>
  <div class="modal fade" id="createServerModal" tabindex="-1" role="dialog" aria-labelledby="createServerModallLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createServerModalLabel">Creating server</h5>
          <button type="button" class="close hideWhileCreating" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="hideWhileCreating">
            <span style="color: black;">Server name</span>
            <input type="text" class="form-control srvNamee" required><br>
            <span style="color: black;">Core</span><br>
            <select class="custom-select coreSelect" required></select><br><br>
            <span style="color: black;">Memory (-Xmx)</span>
            <input type="number" class="form-control xmxMem" min=1024 value=2560 max=8192 step=512 required><br>
            <span style="color: black;">Port (2000 - 60000)</span>
            <input type="number" class="form-control srvPort" min=2000 value=25565 max=60000 required><br>
            <div class="custom-control custom-toggle my-2">
              <input type="checkbox" id="omtoggle" name="omtoggle" class="custom-control-input onMode" checked>
              <label class="custom-control-label" for="omtoggle" style="color: black;">Online mode (only license
                players)</label>
            </div>
          </div>
          <div class="showWhileCreating">
            <center>
              <p style="color: black;">Searching core</p>
              <progress id="downProgress" max="100" value="0"></progress>
            </center>
          </div>
        </div>
        <div class="modal-footer hideWhileCreating">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary createSrvButton">Create</button>
        </div>
      </div>
    </div>
  </div>

  <div class="mainLayout">
    <div class="menu">
      <div class="fc">
        <img src="assets/logo.svg" width="200px">
        <center>
          <p style="margin-top: 4px; width: max-content; height: min-content;" class="kubekVersion"></p>
        </center>

        <ul class="nav flex-column nav-pills nav-justified">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/">Servers</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/settings.html">Settings</a>
          </li>
        </ul>
      </div>

      <div class="fc">
        <div class="pbara">
          <div class="cBar">
            <div id="cpuBar" style="width: 60px; height: 30px;"></div>
          </div>
          <div class="mBar">
            <div id="memoryBar" style="width: 60px; height: 30px;"></div>
          </div>
          <div class="cCapt">CPU</div>
          <div class="cValue"></div>
          <div class="mCapt">Memory</div>
          <div class="mValue"></div>
        </div>
      </div>
    </div>
    <div class="layout">
      <div class="block header">
        <div class="item"></div>
        <div class="item">
          <select class="custom-select serSelect" style="background: rgb(43,53,63); color: white; border: 0;"></select>
        </div>
        <div class="item">
          <button type="button" class="btn btn-outline-light toggleCreateServerModal" data-toggle="modal"
            data-target="#createServerModal" data-backdrop="static" data-keyboard="false">Create
            server</button>
        </div>
      </div>
      <div class="block tabs lay2">
        <div class="blck">
          <div class="hdr">
            <div class="hdr-left">
              <div class="gcont">
                <div class="g-img" style="cursor: pointer;" onclick="changeServerIcon()"><img alt="" height=64
                    class="rounded"></div>
                <form id="g-img-form" enctype="multipart/form-data">
                  <input name="g-img-input" id="g-img-input"
                    style="position: absolute; left: -2582px; right: 0; top: 0; bottom: 0; z-index: -285;" type="file">
                </form>
                <div class="g-caption servername" style="font-size: 20pt; font-weight: 500;"></div>
                <div class="g-srvaddr">
                  <div class="seamlessCont" style="color: rgb(140,140,140);">
                    <div class="seamlessBox"><span class="material-icons material-icons-outlined">language</span></div>
                    <div class="seamlessBox srvIP" style="font-weight: 500;"></div>
                  </div>
                </div>
                <div class="g-srvplayers">
                  <div class="seamlessCont" style="color: rgb(140,140,140);">
                    <div class="seamlessBox"><img src="https://minotar.net/avatar/Steve/24" alt=""></div>
                    <div class="seamlessBox srvPlayersCount" style="font-weight: 500;"></div>
                  </div>
                </div>
                <div class="g-srvcore">
                  <div class="seamlessCont" style="color: rgb(140,140,140);">
                    <div class="seamlessBox"><span class="material-icons material-icons-outlined">bookmark</span></div>
                    <div class="seamlessBox srvCore" style="font-weight: 500;"></div>
                  </div>
                </div>
                <div class="g-srvstatus">
                  <span class="badge badge-success srvStatus" style="margin-left: 8px;">Online</span>
                </div>
              </div>
            </div>
            <div class="hdr-right">
              <button type="button" class="btn btn-primary startbtn">Start</button>
              <button type="button" class="btn btn-danger stopbtn">Shut down</button>
            </div>
          </div>
        </div>
        <div class="blck">
          <div class="tabs">
            <div class="tab selected">Console</div>
            <div class="tab">Players</div>
            <div class="tab">Plugins</div>
            <div class="tab">Settings</div>
            <div class="tab">Server.properties</div>
          </div>
        </div>
      </div>
      <div class="block main"></div>
    </div>
  </div>
</body>

<script>
  var old_ntcpool = [];
  $(document).ready(function () {
    updateServersStatus();
    updateIP();
    updateServersList();
  });

  $(document).ready(function () {
    updateUsage();
  });

  setInterval(function () {
    updateUsage();
  }, 10000);

  setInterval(function () {
    $.get("/tasks/progress", function (data) {
      $(".ntc-pool").html("");
      if (typeof (ntc_pool) === "undefined" || old_ntcpool != data) {
        if (typeof (ntc_pool) !== "undefined") {
          keys1 = Object.keys(data);
          keys2 = Object.keys(old_ntcpool);
          diff = arr_diff(keys1, keys2);
          diff.forEach(function (diffi) {
            if (data[diffi] === undefined && old_ntcpool[diffi] !== undefined) {
              Toastify({
                text: "Скачивание завершено: " + diffi,
                duration: 1500,
                newWindow: true,
                close: false,
                gravity: "bottom",
                position: "left",
                stopOnFocus: true,
                style: {
                  background: "#0067f4",
                  color: "white",
                },
                onClick: function () {}
              }).showToast();
            }
          });
        }
        old_ntcpool = data;
      }
      Object.keys(data).forEach(function (k) {
        $(".ntc-pool").append(
          '<div class="ntc ntc-poolbox" style="background: rgb(43,53,63); color: white;"><div class="ntb">Downloading ' +
          k + ' (' + data[k] + '%)</div><div class="ntb"><progress max="100" value="' + data[k] +
          '" class="pnf"></progress></div></div>');
      });
    });
  }, 200);

  function arr_diff(a1, a2) {
    var a = [],
      diff = [];
    for (var i = 0; i < a1.length; i++) {
      a[a1[i]] = true;
    }
    for (var i = 0; i < a2.length; i++) {
      if (a[a2[i]]) {
        delete a[a2[i]];
      } else {
        a[a2[i]] = true;
      }
    }
    for (var k in a) {
      diff.push(k);
    }
    return diff;
  };
</script>