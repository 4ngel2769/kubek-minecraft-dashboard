<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Kubek - Minecraft Servers</title>

  <!-- MDB -->
  <script src="js/mdb.min.js"></script>
  <link rel="stylesheet" href="css/mdb.min.css">

  <!-- Others -->
  <script src="js/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="css/animate.min.css" />
  <link rel="stylesheet" href="css/toastify.min.css" />
  <script src="js/socket.io.min.js"></script>
  <script src="js/toastify-js.js"></script>
  <script src="js/sweetalert2.all.min.js"></script>

  <!-- Own -->
  <link rel="stylesheet" href="css/globals.css" />
  <link rel="stylesheet" href="css/template.nav.css" />
  <script src="js/funcs.js"></script>

  <!-- Fonts and icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Open Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Page unique -->
  <link rel="stylesheet" href="css/pages/server.properties.css">
</head>

<body>
  <div id="oldc">
    <div class="ttgrid">
      <div class="tr1">
        <div class="ttb"></div>
      </div>
      <div class="tr2">
        <div class="ttb"></div>
      </div>
      <div class="tr3">
        <div class="ttb"></div>
      </div>
      <div class="tr4">
        <div class="ttb"></div>
      </div>
    </div>

    <br><br><button type="button" class="btn btn-secondary btn-lg" onclick="saveProps()">{{save}}</button>
  </div>
</body>

<script>
  var socket;
  $(document).ready(function () {
    loadTemplate(function () {
      hideLoading();
    });
    socket = openSocket();
    setTimeout(function () {
      $.get("/server/properties/get?server=" + currentServer, function (data) {
        keys = Object.keys(data);
        fulls = data;
        keys.forEach(function (key, i) {
          if (i < 15) {
            column = 1;
          } else if (i >= 15 && i < 30) {
            column = 2;
          } else if (i >= 30 && i < 45) {
            column = 3;
          } else if (i >= 45) {
            column = 4;
          }
          znach = fulls[key];
          if (typeof znach == "boolean") {
            if (znach == true) {
              checkd = " checked";
            } else {
              checkd = "";
            }
            $(".tr" + column + " .ttb").append(
              '<div class="ttc"><div class="form-check form-switch cbox"><input type="checkbox" role="switch" id="ct' +
              i + '" name="ct' + i + '" class="form-check-input"' + checkd +
              '><label class="stlabel form-check-label" for="ct' + i + '">' + key +
              '</label></div>');
          } else {
            if (znach != null) {
              $(".tr" + column + " .ttb").append(
                '<div class="ttc ttbb"><div class="ttcc"><input type="text" style="width: 256px" class="form-control" value="' +
                znach + '"></div><div class="ttcc"><span>' + key + '</span></div></div>');
            } else {
              $(".tr" + column + " .ttb").append(
                '<div class="ttc ttbb"><div class="ttcc"><input type="text" style="width: 256px" class="form-control" value=""></div><div class="ttcc"><span>' +
                key + '</span></div></div>');
            }
          }
        });
      });
    }, 400);

    socket.on("handshake", function () {
      console.log("Socket handshake success");
      socket.emit("update", {
        type: "servers"
      });
    });
    socket.on("handleUpdate", function (arg) {
      type = arg.type;
      data = arg.data;
      switch (type) {
        case "servers":
          if (data[currentServer].status == "stopped") {
            $("#server-status").removeClass("badge-success badge-warning");
            $("#server-status").addClass("badge-danger");
            $("#server-status").html("Offline");
            $("#server-start-button").show();
            $("#server-stop-button").hide();
          } else if (data[currentServer].status == "started") {
            $("#server-status").removeClass("badge-danger badge-warning");
            $("#server-status").addClass("badge-success");
            $("#server-status").html("Online");
            $("#server-start-button").hide();
            $("#server-stop-button").show();
          } else if (data[currentServer].status == "starting") {
            $("#server-status").removeClass("badge-success badge-danger");
            $("#server-status").addClass("badge-warning");
            $("#server-status").html("Starting");
            $("#server-start-button").hide();
            $("#server-stop-button").hide();
          } else if (data[currentServer].status == "stopping") {
            $("#server-status").removeClass("badge-success badge-danger");
            $("#server-status").addClass("badge-warning");
            $("#server-status").html("Stopping");
            $("#server-start-button").hide();
            $("#server-stop-button").hide();
          }
          break;
        case "downloadTasks":
          $(".ntc-pool").html("");
          Object.keys(data).forEach(function (k) {
            $(".ntc-pool").append(
              '<div class="ntc ntc-poolbox" style="background: rgb(43,53,63); color: white;"><div class="ntb">Downloading ' +
              k + ' (' + data[k] + '%)</div><div class="ntb"><progress max="100" value="' + data[k] +
              '" class="pnf"></progress></div></div>');
          });
          break;
      }
    });
  });

  function saveProps() {
    var sp;
    $(".ttgrid .cbox").each(function () {
      chk = $(this).find("input").is(':checked') ? true : false;
      key = $(this).find("label").html();
      if (typeof (sp) !== "undefined") {
        sp = sp + "\n" + key + "=" + chk;
      } else {
        sp = key + "=" + chk;
      }
    });
    $(".ttbb").each(function () {
      value = $(this).find("input").val();
      key = $(this).find("span").html();
      sp = sp + "\n" + key + "=" + value;
    });
    sp = btoa(sp);
    $.get("/server/properties/save?doc=" + sp + "&server=" + currentServer);
    Toastify({
      text: "{{settingsSaved}}",
      duration: 3000,
      newWindow: true,
      close: false,
      gravity: "bottom",
      position: "left",
      stopOnFocus: true,
      style: {
        background: "#0067f4",
        color: "white",
      },
      onClick: function () {}
    }).showToast();
  }
</script>