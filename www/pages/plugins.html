<div class="window" style="width: 100%;">
  <div class="blck">
    {{plugins}}
    <button type="button" class="btn btn-primary btn-sm" onclick="loadPage('plmanager')">{{pluginManager}}</button>
  </div>
  <div class="blck" style="height: 512px; overflow: auto;">
    <input type="text" class="form-control searchBar" placeholder="Search"><br>
    <table class="ttt2"></table><br><br>
    <div class="ggg" style="width: auto; justify-content: center;">
      <div class="ggg-box">
        <button type="button" class="btn btn-secondary" onclick="prevPage()"><span
            class="material-icons material-icons-outlined">keyboard_arrow_left</span></button>
      </div>
      <div class="ggg-box">
        <button type="button" class="btn btn-secondary" onclick="nextPage()"><span
            class="material-icons material-icons-outlined">keyboard_arrow_right</span></button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="selectPluginModal" tabindex="-1" role="dialog" aria-labelledby="selectPluginModallLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="selectPluginModallLabel">{{downloadingFile}}</h5>
      </div>
      <div class="modal-body">
        <center>
          <p style="color: black;" class="spStatus">{{selectVersion}}</p>
          <select class="custom-select spSelect"></select><br><br><br>
          <button type="button" class="btn btn-primary spInstall">{{ok}}</button>
        </center>
      </div>
    </div>
  </div>
</div>

<script>
  var page = 1;

  $(document).ready(function () {
    updateFromPage();
  });

  function updateFromPage() {
    $(".loadBg").show();
    $(".blck .ttt2").html("");
    if (page == 1) {
      $.get("/bukkitorg/plugins/list?server=" + currentServer, function (data) {
        data.forEach(function (elem) {
          btnt = "";
          if (elem.showbtn == true) {
            btnt = '<button class="btn btn-light" style="color: black;" onclick="downloadPlugin(' + "'" + elem
              .name + "'" + ', ' + "'" + elem.download_url + "'" +
              ')" data-toggle="tooltip" data-placement="top" title="Download"><span class="material-icons material-icons-outlined">download</i></button>';
          }
          $(".blck .ttt2").append('<tr><td><img alt="" src="' + elem.image_url + '"></td><td>' + elem.name +
            '</td><td>' + btnt + '</td></tr>');
        });
        $(".loadBg").hide();
      });
    } else {
      $.get("/bukkitorg/plugins/list?page=" + page + "&server=" + currentServer, function (data) {
        data.forEach(function (elem) {
          btnt = '<button class="btn btn-light" style="color: black;" onclick="downloadPlugin(' + "'" + elem
            .name + "'" + ', ' + "'" + elem.download_url + "'" +
            ')" data-toggle="tooltip" data-placement="top" title="Download"><span class="material-icons material-icons-outlined">download</i></button>';
          $(".blck .ttt2").append('<tr><td><img alt="" src="' + elem.image_url + '"></td><td>' + elem.name +
            '</td><td>' + btnt + '</td></tr>');
        });
        $(".loadBg").hide();
      });
    }
  }

  $(".searchBar").keydown(function (e) {
    if (e.keyCode == 13) {
      $(".loadBg").show();
      $(".blck .ttt2").html("");
      $.get("/bukkitorg/plugins/search?search=" + $(".searchBar").val(), function (data) {
        data.forEach(function (elem) {
          btnt = '<button class="btn btn-light" style="color: black;" onclick="downloadPlugin(' + "'" + elem
            .name + "'" + ', ' + "'" + elem.url + "'" +
            ')" data-toggle="tooltip" data-placement="top" title="Download"><span class="material-icons material-icons-outlined">download</i></button>';
          $(".blck .ttt2").append('<tr><td><img alt="" src="' + elem.image_url + '"></td><td>' + elem.name +
            '</td><td>' + btnt + '</td></tr>');
        });
        $(".loadBg").hide();
      });
      $(".searchBar").val("");
    }
  });

  function prevPage() {
    if (page != 1) {
      page--;
      updateFromPage();
    }
  }

  function nextPage() {
    page++;
    updateFromPage();
  }

  function downloadPlugin(fn, url) {
    myModal = new bootstrap.Modal(document.getElementById('selectPluginModal'));
    myModal.show();
    $("#selectPluginModal .spSelect").hide();
    $("#selectPluginModal .spInstall").hide();
    $("#selectPluginModal .spStatus").html("{{searching}}");
    $("#selectPluginModal #selectPluginModallLabel").html(fn);
    filesUrl = url.replace("/latest", "");
    $.get("/bukkitorg/versions?url=" + filesUrl, function (data) {
      $("#selectPluginModal .spSelect").show();
      $("#selectPluginModal .spSelect").html("");
      $("#selectPluginModal .spInstall").show();
      $("#selectPluginModal .spStatus").html("{{selectVersion}}");
      data.forEach(function (item) {
        $("#selectPluginModal .spSelect").append("<option data-url='" + item.url + "'>" + item.name +
          "</option>");
      });
    });

    $("#selectPluginModal .spInstall").unbind("click");
    $("#selectPluginModal .spInstall").click(function () {
      fnn = $("#selectPluginModal #selectPluginModallLabel").html().split(" ").join("_") + "-" + $(
        "#selectPluginModal .spSelect option:selected").html().split(" ").join("_") + ".jar";
      urll = $("#selectPluginModal .spSelect option:selected").data("url");
      $.get("/file/download?filename=" + fnn + "&url=" + urll + "&server=" + currentServer + "&type=plugin");
      myModal.hide();
    });
  }

  $(document).ready(function () {
    if ($(".g-srvstatus .srvStatus").html() == "{{online}}") {
      updateQuery();
    } else {
      $(".g-srvcore .srvcore").html("{{unknown}}");
      $(".g-srvplayers .srvplayerscount").html("{{unknown}}");
    }

    di2 = setInterval(function () {
      updateServersStatus();
    }, 500);

    di = setInterval(function () {
      if ($(".g-srvstatus .srvStatus").html() == "{{online}}") {
        updateQuery();
      } else {
        $(".g-srvcore .srvcore").html("{{unknown}}");
        $(".g-srvplayers .srvplayerscount").html("{{unknown}}");
      }
    }, 800);
  });
</script>

<style>
  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  td,
  th {
    border-bottom: 1px solid rgb(140, 140, 140);
    text-align: left;
    padding: 12px;
  }

  td:first-child {
    width: 1%;
    white-space: nowrap;
  }

  td:last-child {
    text-align: right;
  }
</style>