<!--
  #kubek-version (v2.0.0)
  #servers-list (node)
  #current-server (node)
  #add-new-server (event)
  #server-start-button (event)
  #server-stop-button (event)
  #server-status (text and class bg)
-->

<body>
  <div class="layout">
    <div class="navigation">
      <div class="h-100 w-100 d-flex flex-column justify-content-center align-items-stretch" style="padding: 24px;">
        <div class="align-self-center">
          <img width="250px" src="assets/logo.svg">
        </div>
        <div class="align-self-center" id="kubek-version">v2.0.0</div>
        <div class="w-100 d-flex justify-content-center align-items-center">
          <div id="server-selector" class="h-100 w-100">
            <div class="dropdown flex-fill">
              <button type="button" class="btn w-100" id="serverSelectButton" data-mdb-toggle="dropdown"
                aria-expanded="false">
                <div class="d-flex justify-content-center align-items-center" id="current-server"></div>
              </button>
              <ul class="dropdown-menu w-100" aria-labelledby="serverSelectDropdown" id="servers-list"></ul>
            </div>
          </div>
          <div>
            <button type="button" style="margin-left:8px;" id="add-new-server" class="btn btn-dark btn-floating"
              onclick="window.location='/new.server.html'">
              <span class="material-icons">add</span>
            </button>
          </div>
        </div>
        <div id="nav-menu" class="flex-fill">
          <ul class="list-group list-group-flush">
            <li class="list-group-item subheader">{{servers-uppcase}}</li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/index.html">
              <div><span class="material-icons">grid_view</span></div>
              <div class="flex-fill">{{dashboard}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/console.html">
              <div><span class="material-icons">terminal</span></div>
              <div class="flex-fill">{{console}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/plugins.html">
              <div><span class="material-icons">extension</span></div>
              <div class="flex-fill">{{plugins}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/players.html">
              <div><span class="material-icons">people</span></div>
              <div class="flex-fill">{{players}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/server.properties-editor.html">
              <div><span class="material-icons">receipt</span></div>
              <div class="flex-fill">{{server-prop-editor}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/server-settings.html">
              <div><span class="material-icons">dns</span></div>
              <div class="flex-fill">{{server-settings}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/file-manager.html">
              <div><span class="material-icons">folder</span></div>
              <div class="flex-fill">{{file-manager}}</div>
            </li>
            <li class="list-group-item subheader">KUBEK</li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/hosting-settings.html">
              <div><span class="material-icons">tune</span></div>
              <div class="flex-fill">{{kubek-settings}}</div>
            </li>
            <li class="list-group-item item h-100 d-flex justify-content-start align-items-center"
              data-url="/hardware-info.html">
              <div><span class="material-icons">device_unknown</span></div>
              <div class="flex-fill">{{hardware-info}}</div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="page" id="contentHere">pg</div>
    <div class="controls">
      <div class="buttons">
        <button type="button" class="btn btn-danger btn-floating" id="server-stop-button"
          onclick="$.get('/server/sendCommand?server=' + currentServer + '&cmd=stop')">
          <span class="material-icons">power_settings_new</span>
        </button>
        <button type="button" class="btn btn-success btn-floating" id="server-start-button"
          onclick="$.get('/server/start?server=' + currentServer)">
          <span class="material-icons">power_settings_new</span>
        </button>
      </div>
      <div class="status">
        <h3 class="badge" id="server-status">{{server-status}}</h3>
      </div>
    </div>
  </div>
  <div id="loading-overlay" class="w-100 h-100 d-flex justify-content-center align-items-center">
    <div class="spinner-border text-primary" style="width: 5rem; height: 5rem;" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div class="ntc-pool"></div>
</body>

<script>
  var searchParams;
  var currentServer;

  $(document).ready(function () {
    searchParams = new URLSearchParams(window.location.search);
    currentServer = searchParams.get("server");
    $("#kubek-version").load("/kubek/version");
    $.get("/kubek/updates", function (updates) {
      if (typeof updates.found === "undefined") {
        updates = JSON.parse(updates);
      }
      if (updates.found) {
        Toastify({
          text: "{{update-found}}",
          duration: 2500,
          destination: updates.url,
          newWindow: true,
          close: false,
          gravity: "top",
          position: "left",
          stopOnFocus: true,
          style: {
            background: "#1266F1",
          },
          onClick: function () {}
        }).showToast();
      }
    });
    $.get("/server/statuses", function (statuses) {
      if (statuses == false || statuses == "false" || Object.keys(statuses).length == 0) {
        window.location = "/new.server.html";
      } else {
        for (var key in statuses) {
          var value = statuses[key];
          icon = "/server/icon?server=" + key;
          servername = key;
          $("#servers-list").append('<li><a class="dropdown-item" href="?server=' + servername +
            '"> <div class="d-flex justify-content-center align-items-center"> <div><img src="' + icon +
            '" class="rounded-circle" width=24 height=24></div> <div style="margin-left: 8px; width: 1px; text-transform: none;" class="flex-fill text-truncate">' +
            servername + '</div> </div> </a></li>');
        }
        if (currentServer == "null" || currentServer == null) {
          window.location = window.location.pathname + "?server=" + $("#servers-list li").eq(0).find(
            ".text-truncate").text();
        } else {
          serverFinded = false;
          $("#servers-list li").each(function () {
            if ($(this).find(".text-truncate").text() == currentServer) {
              serverFinded = true;
              $("#current-server").html($(this).find(".d-flex").html());
            }
          });
          if (serverFinded == false) {
            window.location = window.location.pathname + "?server=" + $("#servers-list li").eq(0).find(
              ".text-truncate").text();
          }
        }
        var pn = window.location.pathname;
        if (pn == "/") {
          pn = "/index.html";
        }
        $(".list-group-item.item").each(function () {
          if ($(this).data("url") == pn) {
            $(this).addClass("active");
          }
        });
        $(".list-group-item.item").click(function () {
          $(".list-group-item.item.active").removeClass("active");
          $(this).addClass("active");
          showLoading();
          window.location = $(this).data("url") + window.location.search;
        });
      }

    });
  });
</script>